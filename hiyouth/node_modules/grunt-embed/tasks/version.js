/*
 * grunt-embed
 * http://www.wuhaozheng.com
 */

module.exports = function(grunt) {
	'use strict';
	
	grunt.registerTask('version', '', function(param) {
		
		var config = grunt.config.get('version');
		//设置默认选项
		
		console.log(config);
		var file = config.src || 'version.js';
		
		var data = {
				key : 'pageVersion'
			};

		if (grunt.file.exists(file)) {
			var content = grunt.file.read(file);
			var arr = content.replace('seajs.', '').replace(';','').replace(/\s=\s/, '=').split('=');
			if(arr.length == 2 && arr[0]==data.key){
				data.value = parseInt(arr[1]);
			} else {
				grunt.log.warn('版本文件格式不正确，请修正或删除！');
			}
		} else {
			data.value = 1;
			grunt.log.success('版本文件：' + file + '不存在，重新创建...');
		}
		
		if(data.value){
			++data.value;
			grunt.file.write(file, 'seajs.'+data.key+' = '+data.value+';');
			var newFile = config.dest + 'version.js';
			grunt.file.copy(file, newFile);
		}
		
		return;
	});

};